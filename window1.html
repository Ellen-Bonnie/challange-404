<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Parse XML with DMS Coordinates</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 300px; margin-bottom: 10px; font-family: monospace; }
    button { padding: 10px 20px; margin-right: 10px; }
    #result { white-space: pre-wrap; background: #f9f9f9; padding: 15px; border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>

<h2>Paste XML and Extract Coordinates (Areas, Lines, Circles)</h2>

<textarea id="xmlInput" placeholder="Paste your XML here..."></textarea>
<br>
<button onclick="parseXML()">Parse XML</button>
<button onclick="downloadTextFile()">Download .txt</button>

<div id="result"></div>

<script>
  let parsedOutput = '';

  function toDMS(deg, isLat) {
    const absolute = Math.abs(deg);
    const degrees = Math.floor(absolute);
    const minutesNotTruncated = (absolute - degrees) * 60;
    const minutes = Math.floor(minutesNotTruncated);
    const seconds = ((minutesNotTruncated - minutes) * 60).toFixed(2);

    const direction = deg >= 0
      ? (isLat ? "N" : "E")
      : (isLat ? "S" : "W");

    return `${degrees}Â°${minutes}â€²${seconds}â€³ ${direction}`;
  }

  function parseXML() {
    const xmlString = document.getElementById('xmlInput').value;

    if (!xmlString.trim()) {
      document.getElementById('result').textContent = 'Please paste XML data first.';
      return;
    }

    try {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlString, "application/xml");

      if (xmlDoc.getElementsByTagName("parsererror").length > 0) {
        document.getElementById('result').textContent = 'Error parsing XML. Please check the format.';
        return;
      }

      let output = '';

      // ðŸ”¶ Parse Areas
      const areas = xmlDoc.getElementsByTagName('area');
      for (let i = 0; i < areas.length; i++) {
        const area = areas[i];
        const areaName = area.getAttribute('name') || '(No name)';
        output += `ðŸŸ¨ Area: ${areaName}\n`;

        const vertices = area.getElementsByTagName('vertex');
        for (let j = 0; j < vertices.length; j++) {
          const lat = parseFloat(vertices[j].getAttribute('latitude'));
          const lon = parseFloat(vertices[j].getAttribute('longitude'));
          const latDMS = toDMS(lat, true);
          const lonDMS = toDMS(lon, false);
          output += `  Latitude: ${latDMS}, Longitude: ${lonDMS}\n`;
        }
        output += '\n';
      }

      // ðŸŸ¦ Parse Lines
      const lines = xmlDoc.getElementsByTagName('line');
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const lineName = line.getAttribute('name') || '(No name)';
        const lineTypeEl = line.querySelector('attribute');
        const lineType = lineTypeEl ? lineTypeEl.getAttribute('lineType') : '(no type)';

        output += `ðŸŸ¦ Line: ${lineName}\n`;
        output += `  Type: ${lineType}\n`;

        const vertices = line.getElementsByTagName('vertex');
        for (let j = 0; j < vertices.length; j++) {
          const lat = parseFloat(vertices[j].getAttribute('latitude'));
          const lon = parseFloat(vertices[j].getAttribute('longitude'));
          const latDMS = toDMS(lat, true);
          const lonDMS = toDMS(lon, false);
          output += `  Latitude: ${latDMS}, Longitude: ${lonDMS}\n`;
        }
        output += '\n';
      }

      // ðŸ”µ Parse Circles
      const circles = xmlDoc.getElementsByTagName('circle');
      for (let i = 0; i < circles.length; i++) {
        const circle = circles[i];
        const circleName = circle.getAttribute('name') || '(No name)';
        const attribute = circle.querySelector('attribute');
        const range = attribute ? attribute.getAttribute('range') : '(no range)';

        output += `ðŸ”µ Circle: ${circleName}\n`;
        output += `  Range: ${range} NM\n`;

        const vertex = circle.querySelector('vertex');
        if (vertex) {
          const lat = parseFloat(vertex.getAttribute('latitude'));
          const lon = parseFloat(vertex.getAttribute('longitude'));
          const latDMS = toDMS(lat, true);
          const lonDMS = toDMS(lon, false);
          output += `  Center Latitude: ${latDMS}, Longitude: ${lonDMS}\n`;
        }

        output += '\n';
      }

      parsedOutput = output;
      document.getElementById('result').textContent = output || 'No elements found.';
    } catch (error) {
      document.getElementById('result').textContent = `Error: ${error.message}`;
    }
  }

  function downloadTextFile() {
    if (!parsedOutput) {
      alert("Nothing to download. Please parse XML first.");
      return;
    }

    const blob = new Blob([parsedOutput], { type: 'text/plain' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'parsed_coordinates.txt';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
</script>

</body>
</html>
