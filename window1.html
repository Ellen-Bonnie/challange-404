<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Parse XML with DMS Coordinates</title>
<style>
  body { font-family: Arial, sans-serif; padding:20px; background:#fafafa; display:flex; flex-direction:column; min-height:100vh; }
  h2 { text-align:center; font-size:1.2em; color:#12007a; }
  .main-container { display:flex; align-items:flex-start; gap:30px; margin-bottom:25px; flex-wrap:wrap; }
  .donate-container { flex-shrink:0; display:flex; justify-content:center; align-items:flex-start; }
  .donate-image { width:220px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
  #dropZone { flex:1; position:relative; display:flex; flex-direction:column; align-items:center; gap:12px; border:2px dashed #ccc; border-radius:14px; padding:12px; transition:background 0.3s, border-color 0.3s; }
  #dropZone.dragover { border-color:#007bff; background:#eef7ff; }
  #dropText { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,123,255,0.9); color:white; padding:12px 28px; border-radius:8px; font-size:20px; font-weight:bold; opacity:0; pointer-events:none; transition:opacity 0.3s ease; }
  #dropZone.dragover #dropText { opacity:1; }
  textarea { width:100%; height:300px; font-family:monospace; resize:vertical; }
  .button-container { display:flex; justify-content:center; gap:20px; margin-bottom:40px; flex-wrap:wrap; }
  .fancy-button { border:none; border-radius:30px; background:linear-gradient(to right,#fe606f,#feb174); color:white; font-size:16px; font-weight:700; text-transform:uppercase; cursor:pointer; text-align:center; padding:14px 32px; letter-spacing:0.5px; transition:all 0.3s ease; box-shadow:0 4px 10px rgba(0,0,0,0.15); min-width:180px; }
  .fancy-button:hover { transform:translateY(-2px); filter:brightness(1.08); box-shadow:0 8px 18px rgba(0,0,0,0.25); }
  #result { background:#f9f9f9; padding:15px; border:1px solid #ccc; margin-top:20px; white-space:pre-wrap; font-family:monospace; flex-grow:1; }
  #quoteBox { text-align:center; color:#12007a; font-size:26px; font-style:italic; transition:opacity 0.5s ease; }
  .bullet { font-weight:bold; margin-right:6px; }
  .area { color:#e6b800; }
  .line { color:#007bff; }
  .circle { color:#28a745; }
  .coast { color:#8b4513; }
  .label { color:#9b59b6; }
  .userchart { color:#ff6600; font-weight:bold; }
  .clearing { color:#00bcd4; }
  .tidal { color:#ff1493; }
</style>
</head>
<body>

<h2>XML Coordinate Parser (Areas, Lines, Circles, Coast Lines, Labels, Clearing Lines, Tidals, UserChart)</h2>

<div class="main-container">
  <div class="donate-container">
    <img src="photo_5440463335184268274_y.jpg" alt="Buy me a coffee QR" class="donate-image">
  </div>
  <div id="dropZone">
    <div id="dropText">ðŸ’¡ Drop your XML file here!</div>
    <textarea id="xmlInput" placeholder="Paste your XML here or drop XML file..."></textarea>
    <input type="file" id="fileInput" accept=".xml" hidden />
  </div>
</div>

<div class="button-container">
  <button class="fancy-button" onclick="document.getElementById('fileInput').click()">Upload XML File</button>
  <button class="fancy-button" onclick="downloadTextFile()">Download .txt</button>
</div>

<div id="quoteBox">Loading quote...</div>
<div id="result"></div>

<script>
let parsedOutput='';
let quotes=[];

// Load quotes
fetch('motivational_quotes.txt')
.then(r=>r.text())
.then(t=>{
  quotes=t.split('\n').map(q=>q.trim()).filter(q=>q.length>0);
  showRandomQuote();
})
.catch(()=>{ document.getElementById("quoteBox").textContent="Stay motivated â€” your quotes file couldn't be loaded!"; });

function showRandomQuote(){
  const box=document.getElementById("quoteBox");
  if(quotes.length===0) return;
  box.style.opacity=0;
  setTimeout(()=>{
    const i=Math.floor(Math.random()*quotes.length);
    box.textContent=quotes[i];
    box.style.opacity=1;
  },300);
}

// Format DMS with leading zeros
function toDM(deg,isLat){
  const abs=Math.abs(deg);
  const d=Math.floor(abs);
  const m=(abs-d)*60;
  const dir=deg>=0 ? (isLat?"N":"E") : (isLat?"S":"W");
  const dd=d<10 ? "0"+d : ""+d;
  const mm=m.toFixed(3).padStart(6,"0");
  return `${dd}Â°${mm}â€² ${dir}`;
}

// Convert TIDAL time
function formatTidalTime(min){
  if(min==="(no time)") return min;
  const h=Math.floor(Number(min)/60);
  const m=Number(min)%60;
  const hh=h<10?"0"+h:""+h;
  const mm=m<10?"0"+m:""+m;
  return `${hh}:${mm}`;
}

// Parse XML
function parseXML(){
  showRandomQuote();
  const xmlString=document.getElementById('xmlInput').value.trim();
  if(!xmlString) return alert('Please paste or load XML first.');
  try{
    const parser=new DOMParser();
    const xmlDoc=parser.parseFromString(xmlString,"application/xml");
    if(xmlDoc.getElementsByTagName("parsererror").length>0) return alert('Error parsing XML.');

    let htmlOutput='',textOutput='';

    const usercharts=xmlDoc.getElementsByTagName('userchart');
    if(usercharts.length>0){
      for(let chart of usercharts){
        const chartName=chart.getAttribute('name')||'(No name)';
        const chartDesc=chart.getAttribute('description')||'';
        const chartVer=chart.getAttribute('version')||'';
        htmlOutput+=`<span class="userchart">UserChart name: ${chartName}, Description: ${chartDesc}, Version: ${chartVer}</span>\n`;
        textOutput+=`UserChart name: ${chartName}, Description: ${chartDesc}, Version: ${chartVer}\n`;
        processElements(chart);
      }
    } else processElements(xmlDoc);

    function processElements(root){
      const processTag=(tag,cls,label,extra=()=>{})=>{
        const list=root.getElementsByTagName(tag);
        for(let el of list){
          const name=el.getAttribute('name')||'(No name)';
          htmlOutput+=`<span class="bullet ${cls}">â€¢</span>${label}: ${name}\n${extra(el)}`;
          textOutput+=`${label}: ${name}\n${extra(el,true)}`;
          for(let v of el.getElementsByTagName('vertex')){
            const lat=parseFloat(v.getAttribute('latitude'));
            const lon=parseFloat(v.getAttribute('longitude'));
            const coord=`  ${toDM(lat,true)}, ${toDM(lon,false)}`;
            htmlOutput+=`${coord}\n`;
            textOutput+=`${coord}\n`;
          }
          htmlOutput+='\n'; textOutput+='\n';
        }
      };

      // LINE
      processTag('line','line','LINE',el=>{
        const attr=el.querySelector('attribute');
        const typeAttr=el.querySelector('type');
        let typeMap={'1':'Coast line','2':'Nav line','3':'Route line','4':'Depth line'};
        let lineType=attr?attr.getAttribute('lineType'):'(no type)';
        let type=typeMap[lineType]||`(unknown: ${lineType})`;
        let checkDanger=typeAttr && typeAttr.getAttribute('checkDanger')==='1'?'Danger':'';
        let displayRadar=typeAttr && typeAttr.getAttribute('displayRadar')==='1'?'On Radar':'';
        return `  Type: ${type}\n  ${displayRadar}\n  ${checkDanger}\n`;
      });

      // CLEARING LINE
      processTag('clearingLine','clearing','CLEARING LINE',el=>{
        const attr=el.querySelector('attribute');
        const typeAttr=el.querySelector('type');
        let lineTypeNum=attr?attr.getAttribute('lineType'):'';
        let lineLabel=lineTypeNum==='1'?'NMT':'NLT';
        let checkDanger=typeAttr && typeAttr.getAttribute('isDanger')==='1'?'Danger':'';
        return `${lineLabel} ${el.getAttribute('name')}\n  ${lineLabel} 0Â° ${checkDanger}\n`; 
      });

      // AREA
      processTag('area','area','AREA',el=>{
        const typeAttr=el.querySelector('type');
        let checkDanger=typeAttr && typeAttr.getAttribute('checkDanger')==='1'?'Danger':'';
        let displayRadar=typeAttr && typeAttr.getAttribute('displayRadar')==='1'?'On Radar':'';
        return `  ${displayRadar}\n  ${checkDanger}\n`;
      });

      // CIRCLE
      processTag('circle','circle','CIRCLE',el=>{
        const attr=el.querySelector('attribute');
        const typeAttr=el.querySelector('type');
        let r=attr?parseFloat(attr.getAttribute('range')).toFixed(2):'(no range)';
        let checkDanger=typeAttr && typeAttr.getAttribute('checkDanger')==='1'?'Danger':'';
        let displayRadar=typeAttr && typeAttr.getAttribute('displayRadar')==='1'?'On Radar':'';
        return `  Range: ${r} NM\n  ${displayRadar}\n  ${checkDanger}\n`;
      });

      // LABEL
      processTag('label','label','LABEL',el=>{
        const textAttr=el.querySelector('attribute');
        let txt=textAttr?textAttr.getAttribute('labelText'):'(no text)';
        return `  Text: ${txt}\n`;
      });

      // TIDAL
      processTag('tidal','tidal','TIDAL',el=>{
        const attr=el.querySelector('attribute');
        let o=attr?parseFloat(attr.getAttribute('orientation')).toFixed(2):'(no orientation)';
        let t=attr?attr.getAttribute('type'):'';
        t=t==='1'?'Current': t==='2'?'Predicted':`(unknown: ${t})`;
        let s=attr?parseFloat(attr.getAttribute('strength')).toFixed(2):'(no strength)';
        let time=attr?formatTidalTime(attr.getAttribute('time')):'(no time)';
        return `  Orientation: ${o}\n  Type: ${t}\n  Strength: ${s}\n  Time: ${time}\n`;
      });
    }

    parsedOutput=textOutput;
    document.getElementById('result').innerHTML=htmlOutput||'No recognized elements found.';

  }catch(err){ alert('Error: '+err.message);}
}

function downloadTextFile(){
  if(!parsedOutput) return alert('Nothing to download. Please load and parse XML first.');
  const blob=new Blob([parsedOutput],{type:'text/plain'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='parsed_coordinates.txt';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Drag & Drop
const fileInput=document.getElementById('fileInput');
const dropZone=document.getElementById('dropZone');
const xmlInput=document.getElementById('xmlInput');

fileInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(file) readXMLFile(file);
});

dropZone.addEventListener('dragover',e=>{ e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop',e=>{
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file=e.dataTransfer.files[0];
  if(file && file.name.endsWith('.xml')) readXMLFile(file);
  else alert('Please drop a valid .xml file');
});

function readXMLFile(file){
  const reader=new FileReader();
  reader.onload=e=>{
    xmlInput.value=e.target.result;
    parseXML();
  };
  reader.readAsText(file);
}
</script>

</body>
</html>
