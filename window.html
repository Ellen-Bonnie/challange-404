<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Parse XML with DMS Coordinates</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    h2 {
      text-align: center;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞ –∑–æ–Ω–∞ –∑ textarea —Ç–∞ QR */
    .main-container {
      display: flex;
      align-items: flex-start;
      gap: 30px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    /* QR –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–ª—ñ–≤–∞ */
    .donate-container {
      flex-shrink: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .donate-image {
      width: 220px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Drop zone */
    #dropZone {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      border: 2px dashed #ccc;
      border-radius: 14px;
      padding: 12px;
      transition: background 0.3s, border-color 0.3s;
    }

    #dropZone.dragover {
      border-color: #007bff;
      background: #eef7ff;
    }

    #dropText {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 123, 255, 0.9);
      color: white;
      padding: 12px 28px;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    #dropZone.dragover #dropText {
      opacity: 1;
    }

    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
      resize: vertical;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≤ –æ–¥–∏–Ω —Ä—è–¥ */
    .button-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .fancy-button {
      border: none;
      border-radius: 30px;
      background: linear-gradient(to right, #fe606f, #feb174);
      color: white;
      font-size: 16px;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      text-align: center;
      padding: 14px 32px;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      min-width: 180px;
    }

    .fancy-button:hover {
      transform: translateY(-2px);
      filter: brightness(1.08);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }

    #result {
      background: #f9f9f9;
      padding: 15px;
      border: 1px solid #ccc;
      margin-top: 20px;
      white-space: pre-wrap;
      font-family: monospace;
      flex-grow: 1;
    }

    #quoteBox {
      text-align: center;
      color: #12007a;
      font-size: 26px;
      font-style: italic;
      transition: opacity 0.5s ease;
    }

    .bullet { font-weight: bold; margin-right: 6px; }
    .area { color: #e6b800; }
    .line { color: #007bff; }
    .circle { color: #28a745; }
    .coast { color: #8b4513; }
    .label { color: #9b59b6; }
    .userchart { color: #ff6600; font-weight: bold; }
    .clearing { color: #00bcd4; }
    .tidal { color: #ff1493; }
  </style>
</head>
<body>

<h2>XML Coordinate Parser (Areas, Lines, Circles, Coast Lines, Labels, Clearing Lines, Tidals, UserChart)</h2>

<!-- QR-–∫–æ–¥ –ª—ñ–≤–æ—Ä—É—á, dropZone –ø—Ä–∞–≤–æ—Ä—É—á -->
<div class="main-container">
  <div class="donate-container">
    <img src="photo_5440463335184268274_y.jpg" alt="Buy me a coffee QR" class="donate-image">
  </div>

  <div id="dropZone">
    <div id="dropText">üí° Drop your XML file here!</div>
    <textarea id="xmlInput" placeholder="Paste your XML here or drop XML file..."></textarea>
    <input type="file" id="fileInput" accept=".xml" hidden />
  </div>
</div>

<!-- –¢—ñ–ª—å–∫–∏ –¥–≤—ñ –∫–Ω–æ–ø–∫–∏ -->
<div class="button-container">
  <button class="fancy-button" onclick="document.getElementById('fileInput').click()">Upload XML File</button>
  <button class="fancy-button" onclick="downloadTextFile()">Download .txt</button>
</div>

<div id="quoteBox">Loading quote...</div>
<div id="result"></div>

<script>
  let parsedOutput = '';
  let quotes = [];

  // Load quotes
  fetch('motivational_quotes.txt')
    .then(r => r.text())
    .then(t => {
      quotes = t.split('\n').map(q => q.trim()).filter(q => q.length > 0);
      showRandomQuote();
    })
    .catch(() => {
      document.getElementById("quoteBox").textContent = "Stay motivated ‚Äî your quotes file couldn't be loaded!";
    });

  function showRandomQuote() {
    const box = document.getElementById("quoteBox");
    if (quotes.length === 0) return;
    box.style.opacity = 0;
    setTimeout(() => {
      const i = Math.floor(Math.random() * quotes.length);
      box.textContent = quotes[i];
      box.style.opacity = 1;
    }, 300);
  }

  function toDM(deg, isLat) {
    const abs = Math.abs(deg);
    const d = Math.floor(abs);
    const m = (abs - d) * 60;
    const dir = deg >= 0 ? (isLat ? "N" : "E") : (isLat ? "S" : "W");
    return `${d < 10 ? "0" + d : d}¬∞${m.toFixed(3)}‚Ä≤ ${dir}`;
  }

  function parseXML() {
    showRandomQuote();
    const xmlString = document.getElementById('xmlInput').value.trim();
    if (!xmlString) return alert('Please paste or load XML first.');

    try {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlString, "application/xml");
      if (xmlDoc.getElementsByTagName("parsererror").length > 0)
        return alert('Error parsing XML.');

      let htmlOutput = '', textOutput = '';

      const usercharts = xmlDoc.getElementsByTagName('userchart');
      if (usercharts.length > 0) {
        for (let chart of usercharts) {
          const chartName = chart.getAttribute('name') || '(No name)';
          htmlOutput += `<span class="userchart">UserChart name: ${chartName}</span>\n`;
          textOutput += `UserChart name: ${chartName}\n`;
          processElements(chart);
        }
      } else processElements(xmlDoc);

      function processElements(root) {
        const processTag = (tag, cls, label, extra = () => '') => {
          const list = root.getElementsByTagName(tag);
          for (let el of list) {
            const name = el.getAttribute('name') || '(No name)';
            htmlOutput += `<span class="bullet ${cls}">‚Ä¢</span>${label}: ${name}\n${extra(el)}`;
            textOutput += `${label}: ${name}\n${extra(el, true)}`;
            for (let v of el.getElementsByTagName('vertex')) {
              const lat = parseFloat(v.getAttribute('latitude'));
              const lon = parseFloat(v.getAttribute('longitude'));
              const coord = `${toDM(lat, true)}, ${toDM(lon, false)}`;
              htmlOutput += `  ${coord}\n`;
              textOutput += `  ${coord}\n`;
            }
            htmlOutput += '\n';
            textOutput += '\n';
          }
        };
        processTag('area', 'area', 'AREA');
        processTag('line', 'line', 'LINE', el => {
          const attr = el.querySelector('attribute');
          const type = attr ? attr.getAttribute('lineType') : '(no type)';
          return `  Type: ${type}\n`;
        });
        processTag('clearingLine', 'clearing', 'CLEARING LINE', el => {
          const d = el.getAttribute('description') || '';
          const attr = el.querySelector('attribute');
          const lineType = attr ? attr.getAttribute('lineType') : '(no lineType)';
          const t = el.querySelector('type');
          const danger = t ? t.getAttribute('isDanger') : '(no isDanger)';
          return `  Description: ${d}\n  LineType: ${lineType}\n  IsDanger: ${danger}\n`;
        });
        processTag('circle', 'circle', 'CIRCLE', el => {
          const attr = el.querySelector('attribute');
          let r = attr ? attr.getAttribute('range') : '(no range)';
          if (!isNaN(r)) r = parseFloat(r).toFixed(2);
          return `  Range: ${r} NM\n`;
        });
        processTag('tidal', 'tidal', 'TIDAL', el => {
          const d = el.getAttribute('description') || '';
          const attr = el.querySelector('attribute');
          const o = attr ? attr.getAttribute('orientation') : '(no orientation)';
          const t = attr ? attr.getAttribute('type') : '(no type)';
          const s = attr ? attr.getAttribute('strength') : '(no strength)';
          const time = attr ? attr.getAttribute('time') : '(no time)';
          return `  Description: ${d}\n  Orientation: ${o}\n  Type: ${t}\n  Strength: ${s}\n  Time: ${time}\n`;
        });
        processTag('label', 'label', 'LABEL', el => {
          const text = el.textContent.trim() || '(no text)';
          return `  Text: ${text}\n`;
        });
      }

      parsedOutput = textOutput;
      document.getElementById('result').innerHTML = htmlOutput || 'No recognized elements found.';
    } catch (err) {
      alert('Error: ' + err.message);
    }
  }

  function downloadTextFile() {
    if (!parsedOutput) return alert('Nothing to download. Please load and parse XML first.');
    const blob = new Blob([parsedOutput], { type: 'text/plain' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'parsed_coordinates.txt';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // === Drag & Drop ===
  const fileInput = document.getElementById('fileInput');
  const dropZone = document.getElementById('dropZone');
  const xmlInput = document.getElementById('xmlInput');

  fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) readXMLFile(file);
  });

  dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file && file.name.endsWith('.xml')) readXMLFile(file);
    else alert('Please drop a valid .xml file');
  });

  function readXMLFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
      xmlInput.value = e.target.result;
      parseXML(); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥
    };
    reader.readAsText(file);
  }
</script>

</body>
</html>
